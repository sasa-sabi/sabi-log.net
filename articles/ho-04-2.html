
<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width,initial-scale=1"/>
	<meta name="description" content="笹錆のひとりごと、読んでほしい"/>
	<meta name="format-detection" content="telephone=no"/>
	<meta name="keywords" content="笹錆,日記,個人ブログ,@Today_chokankyo,クオルティゴヤス"/>

  <link rel="shortcut icon" href="https://res.cloudinary.com/dtifkcohv/image/upload/v1687189203/system%20images/favicon/favicon_es0idv.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="https://res.cloudinary.com/dtifkcohv/image/upload/v1687189203/system%20images/favicon/apple-touch-icon_lplyzb.png" />
  <link rel="apple-touch-icon" sizes="57x57" href="https://res.cloudinary.com/dtifkcohv/image/upload/v1687189203/system%20images/favicon/apple-touch-icon-57x57_xgnlql.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="https://res.cloudinary.com/dtifkcohv/image/upload/v1687189203/system%20images/favicon/apple-touch-icon-72x72_ozcelu.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="https://res.cloudinary.com/dtifkcohv/image/upload/v1687189203/system%20images/favicon/apple-touch-icon-76x76_wrgpx8.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="https://res.cloudinary.com/dtifkcohv/image/upload/v1687189202/system%20images/favicon/apple-touch-icon-114x114_qz6dkn.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="https://res.cloudinary.com/dtifkcohv/image/upload/v1687189202/system%20images/favicon/apple-touch-icon-120x120_yn4frq.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="https://res.cloudinary.com/dtifkcohv/image/upload/v1687189202/system%20images/favicon/apple-touch-icon-144x144_okevmd.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="https://res.cloudinary.com/dtifkcohv/image/upload/v1687189202/system%20images/favicon/apple-touch-icon-152x152_crubvw.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://res.cloudinary.com/dtifkcohv/image/upload/v1687189202/system%20images/favicon/apple-touch-icon-180x180_zfbwwn.png" />
  <!-- android用を追加 -->

	<meta property="og:site_name" content="笹錆ログ"/>
	<meta property="og:url" content="https://sabi-log.net/"/>
	<meta property="og:type" content="blog"/>
	<meta property="og:title" content="クソサイトを量産した〜い - 笹錆ログ"/>
	<meta property="og:description" content="クソサイト、作りたいですよね。"/>
	<meta property="og:image" content="https://res.cloudinary.com/dtifkcohv/image/upload/v1689770783/system%20images/archive/top_image_4_jkjutl.png"/>
	<meta property="og:locale" content="ja_JP"/>

	<meta name="twitter:card" content="summary_large_image"/>
	<meta name="twitter:site" content="@Today_chokankyo"/>
	<meta name="twitter:description" content="クソサイト、作りたいですよね。" />
	<meta name="twitter:image:src" content="https://res.cloudinary.com/dtifkcohv/image/upload/v1689770783/system%20images/archive/top_image_4_jkjutl.png" />

	<title>クソサイトを量産した〜い - 笹錆ログ </title>

	<link rel="stylesheet" media="all" href="../css/article.css">
  <script src="../javascript/hamburg.js"></script>

  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0EMMB2N6XP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0EMMB2N6XP');
</script>
</head>

<body>
  <header>
    <div class="container">
      <a class="header-left" href="../index.html"> 笹錆ログ </a>

      <div class="header-right pc-head">
        <a href="#">日替わり</a>
        <a href="../archive.html">記事</a>
        <a href="../profile.html">プロフィール</a>
      </div>

      <div class="header-right hamburger-menu" id="js-hamburger">
        <div class="hamburger-menu-line"></div>
        <div class="hamburger-menu-line"></div>
        <div class="hamburger-menu-line"></div>
      </div>

      <nav class="navigation-menu" id="js-nav">
        <ul>
          <li class="nav-top"></li>
          <li><a href="#">日替わり</a></li>
          <li><a href="../archive.html">記事</a></li>
          <li><a href="../profile.html">プロフィール</a></li>
        </ul>
      </nav>
      
    </div>
  </header>
<div class="toppage"><div class="art-header">
	<div class="toppageImage" style="background-image: url(https://res.cloudinary.com/dtifkcohv/image/upload/v1689770783/system%20images/archive/top_image_4_jkjutl.png);"></div>
		<h1>クソサイトを量産した〜い</h1>
		<p>これは、クソサイトでお金を稼ぎたい話。</p>
	<div class="toppageIcons">
			<a class="topTagIcon" style="display: inline-block;" href="../archive.html">
				<div>
					<img src="https://res.cloudinary.com/dtifkcohv/image/upload/v1689904919/system%20images/article%20icons/back_rm9wo7.png" class="topiconimg">
					<strong>記事一覧<br></strong>
				</div>
			</a>
			<a class="topTwitterIcon" style="display: inline-block;" href="https://twitter.com/share?url=sabi-log.net/articles/ho-04-1.html&amp;text=クソサイト、作りたいですよね。" >
				<div>
					<img src="https://res.cloudinary.com/dtifkcohv/image/upload/v1689904919/system%20images/article%20icons/tweet_yvetxv.png" class="topiconimg">
					<strong>ツイート</strong>
				</div>
			</a>
			<a class="topIssueIcon" style="display: inline-block;" href="https://github.com/sasa-sabi/sabi-log.net/issues">
				<div>
					<img src="https://res.cloudinary.com/dtifkcohv/image/upload/v1689857032/system%20images/article%20icons/issue_ocfhyr.png" class="topiconimg">
					<strong>訂正</strong>
				</div>
			</a>
			<a class="topTimeIcon" style="display: inline-block;" href="../ur/ur-04.html">
				<div>
					<img src="https://res.cloudinary.com/dtifkcohv/image/upload/v1689857032/system%20images/article%20icons/ura_hgg0np.png" class="topiconimg">
					<strong>裏話</strong>
				</div>
			</a>
    	</div>
	</div>
</div></div>
<div class="headline"><div class="top-window window-end">
  <div class="top-pages">
    <a href="./ho-04-1.html" class="page"><strong>prev</strong></a>
    <a href="./ho-04-1.html" class="page"><strong>1</strong></a>
    <a class="now-page"><strong>2</strong></a>
    <a href="./ho-04-3.html" class="page"><strong>3</strong></a>
    <a href="./ho-04-3.html" class="page"><strong>next</strong></a>
  </div>

		<h2>エディタの作成</h2>
		<p><strong class="p-str">大枠の作成</strong></p><p>早速エディタを作ってみます。
		<br>パパっと作って記事にしたいのでHTMLでいいか。
		<br>まずHTMLをこのように記述します。
		</p>
		<pre class="code html"><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;editor&lt;/title&gt;
    &lt;script src=&quot;text/convert.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; media=&quot;all&quot; href=&quot;article.css&quot; /&gt;
  &lt;/head&gt;<br>  &lt;body&gt;
    &lt;div class=&quot;position-fix&quot;&gt;
      &lt;div class=&quot;con&quot;&gt;
        &lt;textarea&gt;#hoge&lt;/textarea&gt;
        &lt;div class=&quot;buttons&quot;&gt;
          &lt;button class=&quot;conv&quot;&gt;Convert&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;result&quot;&gt;
      &lt;div&gt;&lt;/div&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
		<p>
CSSは笹錆ログで普段使いしてるものに、次のコードを追記しましょう。
		</p>
		<pre class="code css"><code>.position-fix{
  width: 50%;
  height: 100%;
  position:fixed;
}<br>.con{
  margin-left: auto;
  margin-right: auto;
  width: 100%;
  height: 90%;
  float: left;
}<br>.con textarea{
  width: 100%;
  height: 52em;
  resize: none;
  overflow-y: scroll;
}<br>.buttons{
  height: 10%;
}<br>.result{
  width: 50%;
  float: right;
}
</code></pre>
		<p>
すると、こんな感じになります。
		</p>
		<img src="https://res.cloudinary.com/dtifkcohv/image/upload/v1689443942/art-4/img3_cixmhc.png" class="art-image" />
		<p>不格好ですが、使えないことはないので続行します。
		<br>このままではMarkdown→HTMLの変換が行えないので、Javascriptで処理しましょう。
		<br>変換用の関数はこんな感じです。
		</p>
		<pre class="code javascript"><code>function convertMarkdownToHtml(markdown) {
  var html = markdown;<br>  // ヘッダー(#)の変換
  html = html.replace(/^#\s+(.*)$/gm, &quot;&lt;h1&gt;$1&lt;/h1&gt;&lt;p&gt;&quot;);
  html = html.replace(/^##\s+(.*)$/gm, &quot;&lt;h2&gt;$1&lt;/h2&gt;&lt;p&gt;&quot;);<br>  // 強調(**テキスト**)の変換
  html = html.replace(/\*\*(.*?)\*\*/g, &quot;&lt;strong&gt;$1&lt;/strong&gt;&quot;);<br>  // 斜体(*テキスト*)の変換
  html = html.replace(/\*(.*?)\*/g, &quot;&lt;em&gt;$1&lt;/em&gt;&quot;);<br>  // リンク([テキスト](URL))の変換
  html = html.replace(/\[(.*?)\]\((.*?)\)/g, &apos;&lt;a href=&quot;$2&quot;&gt;$1&lt;/a&gt;&apos;);<br>  // 改行の変換
  html = html.replace(/\n\n/g, &quot;&lt;br&gt;&quot;);
  html = html.replace(/\n/g, &quot;&lt;br&gt;&quot;);<br>  html = html + &quot;&lt;/p&gt;&quot;;<br>  html = html.replace(/&lt;p&gt;&lt;br&gt;/g, &quot;&lt;p&gt;&quot;);<br>  return html;
}
</code></pre>
		<p>
笹錆ログで登場するのはh1、h2、p、strong、italic、aの6つですので、これらが変換できればよしとしています。
		<br>今回はやってないですが、h1~6までの変換はこのような関数を書くと楽だったりします。
		</p>
		<pre class="code javascript"><code>html = html.replace(/(^|\n)(#+)(.*)/g, function (match, p1, p2, p3) {
    var headerLevel = p2.length;
    return (
      p1 + &quot;&lt;h&quot; + headerLevel + &quot;&gt;&quot; + p3.trim() + &quot;&lt;/h&quot; + headerLevel + &quot;&gt;&quot;
    );
});
</code></pre>
		<p>
あとはtextarea内の要素を取り出して、この関数に通してからresult内に出力すればいいだけです。
		<br>というわけで、こんな感じのをJavascriptに追記しましょう。
		</p>
		<pre class="code javascript"><code>function convertAndDisplay() {
  const markdownInput = document.getElementById(&quot;markdownInput&quot;);
  const htmlOutput = document.getElementById(&quot;htmlOutput&quot;);<br>  const markdownText = markdownInput.value;<br>  var convertedHtml = &quot;&quot;;<br>  convertedHtml +=
    &apos;&lt;div class=&quot;toppage&quot;&gt;&lt;div class=&quot;window&quot;&gt;&apos; +
    convertMarkdownToHtml(paragraph) +
    &apos;&lt;/div&gt;&lt;/div&gt;&apos;;<br>  htmlOutput.innerHTML = convertedHtml;
}
</code></pre>
		<p>
この記述で、HTML内でidがmarkdownInputのものを取り出し、関数に通してからidがhtmlOutputに出力します。
		<br>というわけで、最後にHTMLの一部をこのように変更します。
		</p>
		<pre class="code html"><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;editor_test&lt;/title&gt;
    &lt;script src=&quot;text/convert.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; media=&quot;all&quot; href=&quot;text/article.css&quot; /&gt;
  &lt;/head&gt;<br>  &lt;body&gt;
    &lt;div class=&quot;position-fix&quot;&gt;
      &lt;div class=&quot;con&quot;&gt;
        &lt;textarea id=&quot;markdownInput&quot;&gt;#hoge&lt;/textarea&gt;
        &lt;div class=&quot;buttons&quot;&gt;
          &lt;button onclick=&quot;convertAndDisplay()&quot; class=&quot;conv&quot;&gt;Convert&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;result&quot;&gt;
      &lt;div id=&quot;htmlOutput&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
		<p>
これで左に打ち込んだものを右に出力できるようになりました。
		</p>
		<img src="https://res.cloudinary.com/dtifkcohv/image/upload/v1689444726/art-4/img4_nshhwa.png" class="art-image" />
		<p><strong class="p-str">オリジナル記法の作成</strong></p><p>次にオリジナルの記法をMarkdownに追加しましょう。
		<br>追加するのは吹き出し、メモ、ウィンドウの始めと終わり、マーカー見出しの4つです。
		<br>メモは名古屋旅行に一度、マーカー見出しはLegal Infoに一度出ていますね。
		</p>
		<img src="https://res.cloudinary.com/dtifkcohv/image/upload/v1689445122/art-4/img5_va4fia.png" class="art-image" />
		
		<img src="https://res.cloudinary.com/dtifkcohv/image/upload/v1689445122/art-4/img6_w9ezb5.png" class="art-image" />
		
		<div class="balloon-set-box"><div class="icon-box"><img src="https://res.cloudinary.com/dtifkcohv/image/upload/v1687189206/system%20images/member/member_H_512_b7njv5.png" class="icon"><p>H君</p></div><div class="balloon"><p>このサイトを知ってるやつ全員がLegal Infoまで見てると思うなよ。</p></div></div>
		<p>記法を追加するのは楽で、ConvertHtmlに書き加えるだけです。
		<br>吹き出しは-(人名)「(内容)」、メモは-m(タイトル)「(内容)」、マーカー見出しは-p (タイトル)、ウィンドウの区切りは---で設定できるようにしました。
		<br>コードは次のようになります。
		</p>
		<pre class="code typescript"><code>// メモ（-m(タイトル)「(内容)」）の変換
html = html.replace(
  /-m(.*?)「(.*?)」/g,
  &apos;&lt;/p&gt;\n\t\t&lt;div class=&quot;art-memo&quot;&gt;&lt;h2&gt;$1&lt;/h2&gt;&lt;p class=&quot;memo-text&quot;&gt;$2&lt;/p&gt;&lt;/div&gt;\n\t\t&lt;p&gt;&apos;
);<br>// 吹き出し（-(人名)「(内容)」）の変換
html = html.replace(/-(.*?)「(.*?)」/g, (match, title, content) =&gt; {
  let replacement =
    &apos;&lt;/p&gt;\n\t\t&lt;div class=&quot;balloon-set-box&quot;&gt;&lt;div class=&quot;icon-box&quot;&gt;&lt;img src=&quot;&apos;;
  if (dictionary.hasOwnProperty(title.trim())) {
    replacement += `${dictionary[title.trim()]}`;
  }
  replacement += `&quot; class=&quot;icon&quot;&gt;&lt;p&gt;${title.trim()}&lt;/p&gt;&lt;/div&gt;&lt;div class=&quot;balloon&quot;&gt;&lt;p&gt;${content.trim()}&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;\n\t\t&lt;p&gt;`;
  return replacement;
});<br>// 付箋見出し（-p (タイトル)）の変換
html = html.replace(
  /-p\s+(.*?)$/gm,
  &apos;&lt;/p&gt;&lt;p&gt;&lt;strong class=&quot;p-str&quot;&gt;$1&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&apos;
);
</code></pre>
		
		<pre class="code typescript"><code>function convertAndDisplay(mark: vscode.TextEditor) {
  var convertedHtml = &quot;&quot;;
  var markdown = mark.document.getText();
  const pages = markdown.split(&quot;--p&quot;);<br>  for (var k = 0; k &lt; pages.length; k++) {
    const paragraphs = pages[k].split(&quot;---&quot;); // 「---」で文章を区切る<br>    for (var i = 0; i &lt; paragraphs.length; i++) {
      var paragraph = paragraphs[i].trim();<br>      if (i === 0) {
        convertedHtml +=
          &apos;&lt;div class=&quot;toppage&quot;&gt;&lt;div class=&quot;window&quot;&gt;&apos; +
          convert(paragraph, dictional) +
          &apos;&lt;/div&gt;&lt;/div&gt;&lt;div class=&quot;headline&quot;&gt;&apos;;
      } else if (i === 1) {
        if (i === paragraphs.length - 1) {
          convertedHtml +=
            &apos;&lt;div class=&quot;top-window window-end&quot;&gt;&apos; +
            convert(paragraph, dictional) +
            &quot;&lt;/div&gt;&quot;;
        } else {
          convertedHtml +=
            &apos;&lt;div class=&quot;top-window&quot;&gt;&apos; +
            convert(paragraph, dictional) +
            &quot;&lt;/div&gt;&quot;;
        }
      } else if (i === paragraphs.length - 1) {
        convertedHtml +=
          &apos;&lt;div class=&quot;window window-end&quot;&gt;&apos; +
          convert(paragraph, dictional) +
          &quot;&lt;/div&gt;&quot;;
      } else {
        convertedHtml +=
          &apos;&lt;div class=&quot;window&quot;&gt;&apos; + convert(paragraph, dictional) + &quot;&lt;/div&gt;&quot;;
      }
    }
    convertedHtml += &quot;&lt;/div&gt;&quot;;
  }
  return prevcss + convertedHtml;
}
</code></pre>
		<p>
はじめにウィンドウごとに区切り、区切ったウィンドウごとに変換させています。
		<br>吹き出しの方は名前と画像を対応させる必要があったので、名前をkeyにした辞書配列を作っています。
		</p>
		<img src="https://res.cloudinary.com/dtifkcohv/image/upload/v1689449269/art-4/img7_vqwhm8.png" class="art-image" />
		<p>いい感じですね。
		</p><p><strong class="p-str">ダウンロード処理の作成</strong></p><p>最後にダウンロードをさせましょう。
		<br>今はボタンを押すとコンバートできるような形式にしていますが、このボタンをダウンロードに変え、コンバートは自動で行うように変更します。
		<br>このようにHTML、Javascriptを書き換えてください。
		</p>
		<pre class="code html"><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;editor_test&lt;/title&gt;
    &lt;script src=&quot;text/convert.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; media=&quot;all&quot; href=&quot;text/article.css&quot; /&gt;
  &lt;/head&gt;<br>  &lt;body&gt;
    &lt;div class=&quot;position-fix&quot;&gt;
      &lt;div class=&quot;con&quot;&gt;
        &lt;textarea id=&quot;markdownInput&quot;&gt;#hoge&lt;/textarea&gt;
        &lt;div class=&quot;buttons&quot;&gt;
          &lt;button onclick=&quot;downloadHtmlFile()&quot; class=&quot;down&quot;&gt;download&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;result&quot;&gt;
      &lt;div id=&quot;htmlOutput&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
		
		<pre class="code javascript"><code>var htmlContent = &quot;&quot;;<br>function downloadHtmlFile() {
  const element = document.createElement(&quot;a&quot;);
  element.setAttribute(
    &quot;href&quot;,
    &quot;data:text/html;charset=utf-8,&quot; + encodeURIComponent(htmlContent)
  );
  element.setAttribute(&quot;download&quot;, &quot;converted.html&quot;);<br>  element.style.display = &quot;none&quot;;
  document.body.appendChild(element);<br>  element.click();<br>  document.body.removeChild(element);
}<br>window.onload = function () {
  //500ミリ秒ごとにコンバート処理を行なう
  setInterval(&quot;convertAndDisplay()&quot;, 500);
};
</code></pre>
		<p>
コンバートは0.5秒に1度行うようにしました。
		<br>この状態でボタンを押すと、このようになります。
		</p>
		<img src="https://res.cloudinary.com/dtifkcohv/image/upload/v1689452110/art-4/img8_npniz7.png" class="art-image" />
		</div><div class="window">
		<h2>実戦</h2>
		<p>さて、これで早速クソサイトを量産し、アフィリエイト収益をガツガツ得たいと思います。
		<br>とりあえず記事をポチポチ書いて…..
		</p>
		<img src="https://res.cloudinary.com/dtifkcohv/image/upload/v1689452441/art-4/img9_qgh6f6.png" class="art-image" />
		<p>やりずらっ！！！
		<br>特にtextareaの部分が見にくいです。
		<br>このままでも記事を書けないことはないですが、やはり使い慣れたソフトであるVScodeで同じようなことがしたいですね。
		<br>それと、このままではNotionを使っている意味がない気もしますね。
		<br>というわけで、VScodeの拡張機能を作り、もっと楽な環境を作りましょう。</p>

    <div class="pages">
      <a href="./ho-04-3.html" class="page"><strong>next:拡張機能の作製</strong></a>
    </div>

    </div></div>
</body>

<footer>
  <div class="container">
    <div class="site_cr">
      <a>2023- ©笹錆</a>
    </div>
    <div class="site_legal">
      <a href="../legal.html">Legal info</a>
    </div>
  </div>
</footer>

</html>